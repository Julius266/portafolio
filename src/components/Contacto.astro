---
import Section from '../components/Section.astro';
---
<Section id="contact">
    <div class="max-w-2xl mx-auto text-center">
        <h2 class="text-gray-900 dark:text-gray-100 text-3xl font-bold leading-tight tracking-[-0.015em] mb-4">Ponerse en contacto</h2>
        <p class="text-gray-700 dark:text-gray-400 mb-8">¿Tienes un proyecto en mente o solo quieres saludar? Envíame un mensaje.</p>
        
        <!-- Mensaje de éxito -->
        <div id="success-message" class="hidden mb-6 p-4 bg-green-100 dark:bg-green-900/30 border border-green-400 dark:border-green-700 text-green-700 dark:text-green-400 rounded-lg">
            ¡Mensaje enviado con éxito! Te responderé pronto.
        </div>
        
        <!-- Mensaje de error -->
        <div id="error-message" class="hidden mb-6 p-4 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-400 rounded-lg">
            ❌ Hubo un error al enviar el mensaje. Por favor, intenta de nuevo.
        </div>
        
        <form id="contact-form" class="space-y-6">
            <div>
                <label class="sr-only" for="name">Nombre</label>
                <input 
                    class="w-full px-4 py-3 rounded-lg bg-gray-100 dark:bg-gray-800/50 border border-gray-300 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 dark:text-gray-100 placeholder-gray-500 transition-all" 
                    id="name" 
                    name="name" 
                    placeholder="Nombre" 
                    type="text"
                    required
                />
            </div>
            <div>
                <label class="sr-only" for="email">Correo electrónico</label>
                <input 
                    class="w-full px-4 py-3 rounded-lg bg-gray-100 dark:bg-gray-800/50 border border-gray-300 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 dark:text-gray-100 placeholder-gray-500 transition-all" 
                    id="email" 
                    name="email" 
                    placeholder="Correo electrónico" 
                    type="email"
                    required
                />
            </div>
            <div>
                <label class="sr-only" for="message">Mensaje</label>
                <textarea 
                    class="w-full px-4 py-3 rounded-lg bg-gray-100 dark:bg-gray-800/50 border border-gray-300 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 dark:text-gray-100 placeholder-gray-500 transition-all" 
                    id="message" 
                    name="message" 
                    placeholder="Mensaje" 
                    rows="4"
                    required
                ></textarea>
            </div>
            <button 
                id="submit-btn"
                class="w-full flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-blue-600 text-white text-base font-bold leading-normal tracking-[0.015em] mx-auto hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" 
                type="submit"
            >
                <span id="btn-text" class="truncate">Enviar Mensaje</span>
                <span id="btn-loading" class="truncate hidden">Enviando...</span>
            </button>
        </form>
    </div>
</Section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('contact-form') as HTMLFormElement;
        const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
        const btnText = document.getElementById('btn-text');
        const btnLoading = document.getElementById('btn-loading');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');

        form?.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Ocultar mensajes previos
            successMessage?.classList.add('hidden');
            errorMessage?.classList.add('hidden');

            // Mostrar estado de carga
            submitBtn.disabled = true;
            btnText?.classList.add('hidden');
            btnLoading?.classList.remove('hidden');

            // Obtener datos del formulario
            const formData = new FormData(form);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                message: formData.get('message'),
                to: 'jvi3991zrj@gmail.com'
            };

            try {
                // Opción 1: Usar Web3Forms (GRATIS, sin registro)
                // Regístrate en https://web3forms.com para obtener tu access_key
                const response = await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        access_key: '8ec0fe2f-8f3b-4c9d-939d-ca7cd56bfe00', // ⚠️ OBTÉN TU KEY EN web3forms.com
                        name: data.name,
                        email: data.email,
                        message: data.message
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // Mostrar mensaje de éxito
                    successMessage?.classList.remove('hidden');
                    form.reset();
                } else {
                    throw new Error('Error al enviar');
                }
            } catch (error) {
                // Mostrar mensaje de error
                errorMessage?.classList.remove('hidden');
                console.error('Error:', error);
            } finally {
                // Restaurar botón
                submitBtn.disabled = false;
                btnText?.classList.remove('hidden');
                btnLoading?.classList.add('hidden');
            }
        });
    });
</script>